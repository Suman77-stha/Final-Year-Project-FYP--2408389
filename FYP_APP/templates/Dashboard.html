{% extends "base.html" %}
{% block title %} Dashboard {% endblock title %}

{% block content %}
<div class="dashboard-container">

  <!-- Sidebar -->
  <aside id="sidebar">
    <h1 id="logoText">TradeAI</h1>
    <nav>
      <a href="#">ðŸ“Š <span class="menu-text">Dashboard</span></a>
      <a href="#">ðŸ¤– <span class="menu-text">AI Predictions</span></a>
      <a href="#">ðŸ’¼ <span class="menu-text">Portfolio</span></a>
      <a href="#">ðŸ“ˆ <span class="menu-text">Prediction</span></a>
      <a href="#">ðŸ“° <span class="menu-text">News</span></a>
    </nav>
  </aside>

  <!-- Main Content -->
  <main>

    <!-- Header -->
    <header>
      <h2>Dashboard</h2>

      <!-- Search bar -->
      <form class="search" method="GET" style="margin-bottom:1rem;">
        <input class="search_bar" type="text" name="symbol" placeholder="Search symbol..." list="recentList">
        <datalist id="recentList">
          {% for s in recent_symbols %}
            <option value="{{ s }}">
          {% endfor %}
        </datalist>
        <button type="submit">Search</button>
      </form>

      <div class="notification_profile">
        <button>ðŸ””</button>
        <div class="profile">ðŸ‘¤</div>
      </div>
    </header>

    <!-- Market Overview Cards -->
    <section class="grid">
      {% for stock in Watchdata %}
      <div class="card">
        <h3><a href="?symbol={{ key }}">{{ stock.symbol }}</a></h3>
        <p style="font-size:1.25rem; font-weight:bold;">
          {% if stock %} Price: ${{ stock.close_price }} {% else %} NA {% endif %}
        </p>
        <p>
          {% if stock %}
            {% if stock.change > 0 %}
              <span style="color: #22c55e">{{ stock.change }} â†‘</span>
            {% else %}
              <span style="color: #ef4444">{{ stock.change }} â†“</span>
            {% endif %}
          {% else %} NA {% endif %}
        </p>
      </div>
      {% endfor %}
    </section>

    <div class="content">

      <!-- AI Predictions Chart -->
      <section class="card_ai">
        <h3>AI Price Prediction</h3>
        <div id="forecastChart" style="width:100%; height:100%;"></div>
      </section>

      <!-- Right Container -->
      <div class="right_contain">

        <!-- Balance Info -->
        <section class="amount">
          <div class="Opening_balance">
            <h4>Opening Balance</h4>
            <p id="opening_balance">${{ wallet.balance|floatformat:2 }}</p>
          </div>

          <div class="Today_investment">
            <h4>Today Investment</h4>
            <p id="today_investment">$0.00</p>
          </div>

          <div class="closing_balance">
            <h4>Closing Balance</h4>
            <p id="closing_balance">$0.00</p>
          </div>
        </section>

        <!-- Buy / Sell -->
        <form class="trade_buttons" method="POST">
          {% csrf_token %}
          <input type="hidden" name="symbol" id="trade_symbol">
          <button type="submit" name="action" value="buy" class="buy_btn">BUY</button>
          <button type="submit" name="action" value="sell" class="sell_btn">SELL</button>
        </form>

        <!-- Latest Transactions -->
        <section class="card_data">
          <h3>Latest Transaction</h3>
          <table>
            <thead>
              <tr>
                <th>Symbol</th>
                <th>Current Price</th>
                <th>Change %</th>
                <th>AI Suggestion</th>
              </tr>
            </thead>
            <tbody>
              {% for key, stock in stock_data.items %}
              <tr>
                <td>{{ key }}</td>
                <td>{% if stock %}${{ stock.close_price }}{% else %}NA{% endif %}</td>
                <td>
                  {% if stock %}
                    {% if stock.change_percent > 0 %}
                      <span style="color:#22c55e">
                        {{ stock.change_percent|floatformat:2 }}% â†‘
                      </span>
                    {% else %}
                      <span style="color:#ef4444">
                        {{ stock.change_percent|floatformat:2 }}% â†“
                      </span>
                    {% endif %}
                  {% else %} NA {% endif %}
                </td>
                <td class="text-green">Buy</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </section>

      </div>
    </div>

  </main>
</div>

{% endblock content %}
